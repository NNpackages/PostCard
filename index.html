<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Prognostic covariate adjustment for estimation of estimands • PostCard</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Prognostic covariate adjustment for estimation of estimands">
<meta name="description" content="Convenient functions for conducting analysis using prognostic covariate adjustment for GLMs. The package uses plug-in estimation for robust estimation of the estimand and influence functions for robust estimation of the variance of the estimand.">
<meta property="og:description" content="Convenient functions for conducting analysis using prognostic covariate adjustment for GLMs. The package uses plug-in estimation for robust estimation of the estimand and influence functions for robust estimation of the variance of the estimand.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">PostCard</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/more-details.html">More details on usage of package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="postcard">PostCard<a class="anchor" aria-label="anchor" href="#postcard"></a>
</h1></div>
<!-- badges: start -->

<p>PostCard is a package for PrOgnoSTic CovARiate aDjustment in randomised clinical trials. At the time of writing, the package features convenient functions for conducting analysis using prognostic covariate adjustment for GLMs. The package uses plug-in estimation for robust estimation of a marginal effect estimand and influence functions for robust estimation of the variance of the estimand.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of PostCard from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"NNpackages/PostCard"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nnpackages.github.io/PostCard/">PostCard</a></span><span class="op">)</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_seed.html" class="external-link">local_seed</a></span><span class="op">(</span><span class="fl">1395878</span><span class="op">)</span></span>
<span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">local_options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>PostCard.verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulating-data-for-exploratory-analyses">Simulating data for exploratory analyses<a class="anchor" aria-label="anchor" href="#simulating-data-for-exploratory-analyses"></a>
</h2>
<p>First, we simulate some data to be able to enable showcasing of the functionalities. For this we use the <code><a href="reference/glm_data.html">glm_data()</a></code> function from the package, where the user can specify an expression alongside variables and a family of the response to then simulate a response from a GLM with linear predictor given by the expression provided.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">b0</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Simulate data with a non-linear effect</span></span>
<span><span class="va">dat_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/glm_data.html">glm_data</a></span><span class="op">(</span></span>
<span>  <span class="va">b0</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">+</span><span class="va">b2</span><span class="op">*</span><span class="va">A</span>,</span>
<span>  W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">.5</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Default value</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plug-in-estimation-of-marginal-effects-and-variance-estimation-using-influence-functions">Plug-in estimation of marginal effects and variance estimation using influence functions<a class="anchor" aria-label="anchor" href="#plug-in-estimation-of-marginal-effects-and-variance-estimation-using-influence-functions"></a>
</h2>
<div class="section level3">
<h3 id="fitting-rctglm-without-prognostic-covariate-adjustment">Fitting <code>rctglm()</code> without prognostic covariate adjustment<a class="anchor" aria-label="anchor" href="#fitting-rctglm-without-prognostic-covariate-adjustment"></a>
</h3>
<p>The <code><a href="reference/rctglm.html">rctglm()</a></code> function estimates any specified estimand using plug-in estimation for randomised clinical trials and estimates the variance using the influence function of the marginal effect estimand.</p>
<p>The interface of <code><a href="reference/rctglm.html">rctglm()</a></code> is similar to that of the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> function but with an added mandatory specification of</p>
<ul>
<li>The randomisation variable in data, usually being the (name of) the treatment variable</li>
<li>The randomisation ratio - the probability of being allocated to group 1 (rather than 0)
<ul>
<li>As a default, a ratio of 1’s in data is used</li>
</ul>
</li>
<li>An estimand function
<ul>
<li>As a default, the function takes the average treatment effect (ATE) as the estimand</li>
</ul>
</li>
</ul>
<p>Thus, we can estimate the ATE by simply writing the below:</p>
<blockquote>
<p>Note that as a default, information about the algorithm is printed in the console, but here we suppress this behavior. See more in <code>vignette("non-default")</code>.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rctglm.html">rctglm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">*</span> <span class="va">W</span>,</span>
<span>              group_indicator <span class="op">=</span> <span class="va">A</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dat_treat</span>,</span>
<span>              family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span> <span class="co"># Default value</span></span></code></pre></div>
<p>This creates an <code><a href="reference/rctglm.html">rctglm()</a></code> object which prints as</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ate</span></span>
<span><span class="co">#&gt; Object of class 'rctglm'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  rctglm(formula = Y ~ A * W, group_indicator = A, family = "gaussian", </span></span>
<span><span class="co">#&gt;     data = dat_treat)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Counterfactual control mean (Psi_0=E[Y|X, A=0]) estimate: 2.78</span></span>
<span><span class="co">#&gt; - Counterfactual control mean (Psi_1=E[Y|X, A=1]) estimate: 4.87</span></span>
<span><span class="co">#&gt; - Estimand function r: psi1 - psi0</span></span>
<span><span class="co">#&gt; - Estimand (r(Psi_1, Psi_0)) estimate (SE): 2.09 (0.0921)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="structure-of-rctglm-and-methods-for-extracting-entities">Structure of <code>rctglm</code> and methods for extracting entities<a class="anchor" aria-label="anchor" href="#structure-of-rctglm-and-methods-for-extracting-entities"></a>
</h3>
<p>The <code>print</code> method for the <code>rctglm</code> class specifies the way to print such an object as seen above. Behind the S3 class of <code>rctglm</code> it is a list with</p>
<ul>
<li>Estimand related information
<ul>
<li>Value of plug-in estimation of estimand
<ul>
<li>Accessible through <code>ate$estimand</code> or using method <code>estimand(ate)</code>
</li>
</ul>
</li>
<li>Variance and standard error (SE) of estimand</li>
<li>Accessible through <code>ate$var_estimand</code> and <code>ate$se_estimand</code> as well as the SE with method <code>se_estimand(ate)</code>
</li>
<li>Counterfactual predictions (for each observation) and counterfactual means for both groups
<ul>
<li>Accessible through <code>ate$counterfactual_mean&lt;0/1&gt;</code> and <code>ate$counterfactual_pred&lt;0/1&gt;</code>
</li>
</ul>
</li>
</ul>
</li>
<li>Information on the underlying <code>glm</code> fit
<ul>
<li>Entire <code>glm</code> object available through <code>ate$glm</code>
</li>
<li>Methods <code>coef</code> and <code>summary</code> exist for the <code>rctglm</code> class, which uses the corresponding methods on the <code>glm</code> object contained within <code>rctglm</code>
</li>
</ul>
</li>
</ul>
<p>Thus, methods available are:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/rctglm_methods.html">estimand</a></span><span class="op">(</span><span class="va">ate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.091095</span></span>
<span><span class="fu"><a href="reference/rctglm_methods.html">se_estimand</a></span><span class="op">(</span><span class="va">ate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.09208528</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ate</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           A           W         A:W </span></span>
<span><span class="co">#&gt;  2.77585401  2.09122279  0.02364106  0.04961895</span></span>
<span><span class="co"># summary(ate) # Not printing to avoid long output in formatted output</span></span></code></pre></div>
<p>See more info in the documentation page <code><a href="reference/rctglm_methods.html">rctglm_methods()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="using-prognostic-covariate-adjustment">Using prognostic covariate adjustment<a class="anchor" aria-label="anchor" href="#using-prognostic-covariate-adjustment"></a>
</h3>
<p>The <code><a href="reference/rctglm_with_prognosticscore.html">rctglm_with_prognosticscore()</a></code> function uses the <code><a href="reference/fit_best_learner.html">fit_best_learner()</a></code> function to fit a prognostic model to historical data and then uses the prognostic model to predict</p>
<p>for all observations in the current data set. These <em>prognostic scores</em> are then used as a covariate in the GLM when running <code><a href="reference/rctglm.html">rctglm()</a></code>.</p>
<p>Allowing the use of complex non-linear models to create such a prognostic score allows utilising information from potentially many variables, “catching” non-linear relationships and then using all this information in the GLM model using a single covariate adjustment.</p>
<p>We simulate some historical data to showcase the use of this function as well:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat_notreat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/glm_data.html">glm_data</a></span><span class="op">(</span></span>
<span>  <span class="va">b0</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>  W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="va">gaussian</span> <span class="co"># Default value</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The call to <code><a href="reference/rctglm_with_prognosticscore.html">rctglm_with_prognosticscore()</a></code> is the same as to <code><a href="reference/rctglm.html">rctglm()</a></code> but with an added specification of</p>
<ul>
<li>(Historical) data to fit the prognostic model using <code><a href="reference/fit_best_learner.html">fit_best_learner()</a></code>
</li>
<li>A formula used when fitting the prognostic model
<ul>
<li>Default uses all covariates in the data.</li>
</ul>
</li>
<li>(Optionally) number folds in cross validation and a list of learners for fitting the best learner</li>
</ul>
<p>Thus, a simple call which estimates the average treatment effect, adjusting for a prognostic score, is seen below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ate_prog</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rctglm_with_prognosticscore.html">rctglm_with_prognosticscore</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">*</span> <span class="va">W</span>,</span>
<span>  group_indicator <span class="op">=</span> <span class="va">A</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat_treat</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>, <span class="co"># Default value</span></span>
<span>  data_hist <span class="op">=</span> <span class="va">dat_notreat</span><span class="op">)</span></span></code></pre></div>
<p>Quick results of the fit can be seen by printing the object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ate_prog</span></span>
<span><span class="co">#&gt; Object of class 'rctglm'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:  rctglm_with_prognosticscore(formula = Y ~ A * W, family = gaussian(link = "identity"), </span></span>
<span><span class="co">#&gt;     data = dat_treat, group_indicator = A, data_hist = dat_notreat)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - Counterfactual control mean (Psi_0=E[Y|X, A=0]) estimate: 2.83</span></span>
<span><span class="co">#&gt; - Counterfactual control mean (Psi_1=E[Y|X, A=1]) estimate: 4.82</span></span>
<span><span class="co">#&gt; - Estimand function r: psi1 - psi0</span></span>
<span><span class="co">#&gt; - Estimand (r(Psi_1, Psi_0)) estimate (SE): 1.99 (0.0641)</span></span></code></pre></div>
<p>It’s evident that in this case where there is a non-linear relationship between the covariate we observe and the response, adjusting for the prognostic score reduces the standard error of our estimand approximation by quite a bit.</p>
<div class="section level4">
<h4 id="investigating-the-prognostic-model">Investigating the prognostic model<a class="anchor" aria-label="anchor" href="#investigating-the-prognostic-model"></a>
</h4>
<p>Information on the prognostic model is available in the list element <code>prognostic_info</code> of the resulting object. This contains</p>
<ul>
<li>The fitted prognostic model as a <code>workflow</code>
<ul>
<li>Accessible through <code>ate$prognostic_info$model_fit</code> or with method <code>prog_model(ate)</code>
</li>
</ul>
</li>
<li>A list of the learners used for fitting the model using [fit_best_learner()]
<ul>
<li>Accessible through <code>ate$prognostic_info$learners</code>
</li>
</ul>
</li>
<li>The number of folds used for cross validation (<code>cv_folds</code>) and the historical data used for fitting the model</li>
</ul>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing PostCard</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Mathias Lerbech Jeppesen <br><small class="roles"> Author, maintainer </small>  </li>
<li>Emilie Hoejbjerre-Frandsen <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/NNpackages/PostCard/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/NNpackages/PostCard/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mathias Lerbech Jeppesen, Emilie Hoejbjerre-Frandsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
